<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì´íŠ¸ ìƒì„¸ - ì´ˆë¡ ìº í•‘ì¥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #2d6a4f 0%, #52b788 100%); 
            min-height: 100vh;
        }
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .page-header {
            text-align: center;
            color: white;
            margin: 2rem 0;
        }
        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .detail-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 1.5rem;
        }
        .site-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .site-number-large {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2d6a4f;
        }
        .site-badges {
            display: flex;
            gap: 0.5rem;
        }
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .badge-large {
            background: #28a745;
            color: white;
        }
        .badge-small {
            background: #17a2b8;
            color: white;
        }
        .badge-electric {
            background: #ffc107;
            color: #000;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .info-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
        }
        .info-title {
            color: #2d6a4f;
            font-weight: bold;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .info-item:last-child {
            border-bottom: none;
        }
        .info-label {
            color: #6c757d;
        }
        .info-value {
            color: #333;
            font-weight: 500;
        }
        .calendar-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .calendar-nav {
            display: flex;
            gap: 1rem;
        }
        .calendar-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: #52b788;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        .calendar-btn:hover {
            opacity: 0.9;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            color: #333;
            padding: 0.5rem;
        }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .calendar-day:hover {
            border-color: #52b788;
            background: #f0f8f4;
        }
        .calendar-day.available {
            background: #d4edda;
            border-color: #28a745;
        }
        .calendar-day.reserved {
            background: #f8d7da;
            border-color: #dc3545;
            cursor: not-allowed;
        }
        .calendar-day.past {
            background: #f0f0f0;
            color: #999;
            cursor: not-allowed;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        .btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: opacity 0.3s;
            text-decoration: none;
            text-align: center;
            display: inline-block;
        }
        .btn-primary {
            background: linear-gradient(135deg, #2d6a4f 0%, #52b788 100%);
            color: white;
        }
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        .btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>
    
    <div class="main-container">
        <div class="page-header">
            <h1 id="pageTitle">ì‚¬ì´íŠ¸ ìƒì„¸ ì •ë³´</h1>
        </div>
        
        <div class="detail-card">
            <div class="site-header">
                <div class="site-title">
                    <span class="site-number-large" id="siteNumber">-</span>
                </div>
                <div class="site-badges" id="siteBadges">
                    <!-- ë°°ì§€ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="info-grid">
                <div class="info-section">
                    <h3 class="info-title">ğŸ“ ê¸°ë³¸ ì •ë³´</h3>
                    <div class="info-item">
                        <span class="info-label">ì‚¬ì´íŠ¸ íƒ€ì…</span>
                        <span class="info-value" id="siteType">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ìµœëŒ€ ì¸ì›</span>
                        <span class="info-value" id="maxPeople">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì „ê¸° ì‹œì„¤</span>
                        <span class="info-value" id="hasElectric">-</span>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3 class="info-title">ğŸ•ï¸ ìœ„ì¹˜ ë° íŠ¹ì§•</h3>
                    <div class="info-item">
                        <span class="info- label">ìœ„ì¹˜ ì„¤ëª…</span>
                        <span class="info-value" id="location">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì£¼ë³€ ì‹œì„¤</span>
                        <span class="info-value" id="nearbyFacilities">-</span>
                    </div>
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                <p id="siteDescription" style="color: #666; line-height: 1.6;">-</p>
            </div>
            
            <div class="action-buttons">
                <a href="/sites" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
                <button class="btn btn-primary" onclick="checkAvailability()">ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ í™•ì¸</button>
            </div>
        </div>
        
        <div class="calendar-card" id="calendarCard" style="display: none;">
            <h3 style="color: #2d6a4f; margin-bottom: 1rem;">ğŸ“… ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ</h3>
            <div class="calendar-header">
                <h4 id="calendarMonth">-</h4>
                <div class="calendar-nav">
                    <button class="calendar-btn" onclick="changeMonth(-1)">ì´ì „</button>
                    <button class="calendar-btn" onclick="changeMonth(1)">ë‹¤ìŒ</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- ë‹¬ë ¥ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            <div style="margin-top: 1rem; display: flex; gap: 2rem; justify-content: center;">
                <span><span style="display: inline-block; width: 20px; height: 20px; background: #d4edda; border-radius: 4px; vertical-align: middle;"></span> ì˜ˆì•½ ê°€ëŠ¥</span>
                <span><span style="display: inline-block; width: 20px; height: 20px; background: #f8d7da; border-radius: 4px; vertical-align: middle;"></span> ì˜ˆì•½ ë¶ˆê°€</span>
                <span><span style="display: inline-block; width: 20px; height: 20px; background: #f0f0f0; border-radius: 4px; vertical-align: middle;"></span> ì§€ë‚œ ë‚ ì§œ</span>
            </div>
        </div>
    </div>
    
    <script>
        let currentSiteNumber = '';
        let currentMonth = new Date();
        let siteData = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ì´íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', async function() {
            // URLì—ì„œ ì‚¬ì´íŠ¸ ë²ˆí˜¸ ì¶”ì¶œ
            const pathParts = window.location.pathname.split('/');
            currentSiteNumber = pathParts[pathParts.length - 1];
            
            await loadSiteDetails();
        });
        
        async function loadSiteDetails() {
            try {
                // ì‚¬ì´íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/api/sites');
                const sites = await response.json();
                
                siteData = sites.find(site => site.siteNumber === currentSiteNumber);
                
                if (!siteData) {
                    // ì‚¬ì´íŠ¸ ë²ˆí˜¸ë¡œ ì§ì ‘ ìƒì„±
                    siteData = {
                        siteNumber: currentSiteNumber,
                        maxPeople: currentSiteNumber.startsWith('A') ? 6 : 4
                    };
                }
                
                displaySiteDetails();
            } catch (error) {
                console.error('Error loading site details:', error);
            }
        }
        
        function displaySiteDetails() {
            const isLarge = currentSiteNumber.startsWith('A');
            const siteNum = parseInt(currentSiteNumber.split('-')[1]);
            
            // í˜ì´ì§€ ì œëª©
            document.getElementById('pageTitle').textContent = `ì‚¬ì´íŠ¸ ${currentSiteNumber} ìƒì„¸ ì •ë³´`;
            
            // ì‚¬ì´íŠ¸ ë²ˆí˜¸
            document.getElementById('siteNumber').textContent = currentSiteNumber;
            
            // ë°°ì§€
            let badges = '';
            if (isLarge) {
                badges += '<span class="badge badge-large">ëŒ€í˜•</span>';
                badges += '<span class="badge badge-electric">âš¡ ì „ê¸°</span>';
            } else {
                badges += '<span class="badge badge-small">ì†Œí˜•</span>';
            }
            document.getElementById('siteBadges').innerHTML = badges;
            
            // ê¸°ë³¸ ì •ë³´
            document.getElementById('siteType').textContent = isLarge ? 'ëŒ€í˜• ì‚¬ì´íŠ¸' : 'ì†Œí˜• ì‚¬ì´íŠ¸';
            document.getElementById('maxPeople').textContent = siteData.maxPeople ? `${siteData.maxPeople}ëª…` : (isLarge ? '6ëª…' : '4ëª…');
            document.getElementById('hasElectric').textContent = isLarge ? 'ìˆìŒ' : 'ì—†ìŒ';
            
            // ìœ„ì¹˜ ì •ë³´ - ë°±ì—”ë“œì—ì„œ ë°›ì€ ë°ì´í„° ì‚¬ìš©
            document.getElementById('location').textContent = siteData.location || '-';
            document.getElementById('nearbyFacilities').textContent = siteData.nearbyFacilities || '-';
            
            // ì„¤ëª…
            document.getElementById('siteDescription').textContent = siteData.description || '-';
        }
        
        async function checkAvailability() {
            document.getElementById('calendarCard').style.display = 'block';
            await loadCalendar();
            document.getElementById('calendarCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        async function loadCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            // ì›” í‘œì‹œ
            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('calendarMonth').textContent = `${year}ë…„ ${monthNames[month]}`;
            
            // ë‹¬ë ¥ ê·¸ë¦¬ë“œ ìƒì„±
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // ìš”ì¼ í—¤ë”
            const dayHeaders = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // í•´ë‹¹ ì›”ì˜ ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ë‚ 
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // ì²« ì£¼ì˜ ë¹ˆ ì¹¸
            for (let i = 0; i < firstDay.getDay(); i++) {
                const emptyDiv = document.createElement('div');
                grid.appendChild(emptyDiv);
            }
            
            // ê° ë‚ ì§œì— ëŒ€í•œ ì˜ˆì•½ ìƒíƒœ í™•ì¸
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const currentDate = new Date(year, month, day);
                const dateStr = currentDate.toISOString().split('T')[0];
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = day;
                
                if (currentDate < today) {
                    dayDiv.classList.add('past');
                } else {
                    // ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ (API í˜¸ì¶œ)
                    try {
                        const response = await fetch(`/api/sites/${currentSiteNumber}/availability?date=${dateStr}`);
                        const data = await response.json();
                        
                        if (data.available) {
                            dayDiv.classList.add('available');
                            dayDiv.onclick = () => goToReservation(dateStr);
                        } else {
                            dayDiv.classList.add('reserved');
                        }
                    } catch (error) {
                        console.error('Error checking availability:', error);
                    }
                }
                
                grid.appendChild(dayDiv);
            }
        }
        
        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            loadCalendar();
        }
        
        function goToReservation(date) {
            window.location.href = `/reservations/new?site=${currentSiteNumber}&startDate=${date}&endDate=${date}`;
        }
    </script>
</body>
</html>