Feature: 캠핑 사이트 예약 생성
  캠핑을 원하는 고객이 사이트를 예약할 수 있다

  Background:
    Given 캠핑 사이트 "A-01"이 존재한다
    And 최대 예약 가능 기간은 오늘로부터 30일이다
    And 필수 입력 항목은 "예약자 이름"과 "전화번호"이다
    And 오늘 날짜가 "2025-09-03"이다

  Scenario: 정상적인 예약 생성
    Given 고객 "홍길동" 전화번호 "010-1234-5678"로 예약을 요청한다
    When "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"을 예약한다
    Then 예약이 성공적으로 생성된다
    And 6자리 영숫자 확인 코드가 반환된다
    And 예약 정보가 시스템에 저장된다

  Scenario: 30일 초과 날짜 예약 시도
    Given 고객 "홍길동" 전화번호 "010-1234-5678"로 예약을 요청한다
    When "2025-10-10"부터 "2025-10-12"까지 사이트 "A-01"을 예약한다
    Then 예약이 실패한다
    And "예약은 30일 이내 날짜만 가능합니다" 오류 메시지가 반환된다

  Scenario: 과거 날짜 예약 시도
    Given 고객 "홍길동" 전화번호 "010-1234-5678"로 예약을 요청한다
    When "2025-09-01"부터 "2025-09-02"까지 사이트 "A-01"을 예약한다
    Then 예약이 실패한다
    And "과거 날짜는 예약할 수 없습니다" 오류 메시지가 반환된다

  Scenario: 종료일이 시작일보다 빠른 경우
    Given 고객 "홍길동" 전화번호 "010-1234-5678"로 예약을 요청한다
    When "2025-09-12"부터 "2025-09-10"까지 사이트 "A-01"을 예약한다
    Then 예약이 실패한다
    And "종료일은 시작일보다 늦어야 합니다" 오류 메시지가 반환된다

  Scenario: 필수 정보 누락 - 예약자 이름
    Given 고객이 전화번호 "010-1234-5678"로 예약을 요청한다
    But 예약자 이름이 없다
    When "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"을 예약한다
    Then 예약이 실패한다
    And "예약자 이름은 필수입니다" 오류 메시지가 반환된다

  Scenario: 필수 정보 누락 - 전화번호
    Given 고객 "홍길동" 예약을 요청한다
    But 전화번호가 없다
    When "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"을 예약한다
    Then 예약이 실패한다
    And "전화번호는 필수입니다" 오류 메시지가 반환된다

  Scenario: 동일 사이트, 동일 기간 중복 예약 시도
    Given 사이트 "A-01"이 "2025-09-10"부터 "2025-09-12"까지 이미 예약되어 있다
    And 고객 "이영희"가 전화번호 "010-9876-5432"로 예약을 요청한다
    When "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"을 예약한다
    Then 예약이 실패한다
    And "해당 기간은 이미 예약되어 있습니다" 오류 메시지가 반환된다

Feature: 예약 동시성 제어
  동일한 사이트와 날짜에 대한 동시 예약 요청 시 하나만 성공한다

  Background:
    Given 캠핑 사이트 "A-01"이 존재한다
    And "2025-09-10"부터 "2025-09-12"까지 사용 가능하다

  Scenario: 동시 예약 요청 처리
    Given 고객 "김철수"가 전화번호 "010-1111-1111"로 예약을 준비한다
    And 고객 "이영희"가 전화번호 "010-2222-2222"로 예약을 준비한다
    And 고객 "박민수"가 전화번호 "010-3333-3333"로 예약을 준비한다
    When 세 고객이 동시에 "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"을 예약한다
    Then 오직 1개의 예약만 성공한다
    And 나머지 2개의 예약은 실패한다
    And 실패한 예약들은 "해당 기간은 이미 예약되어 있습니다" 오류 메시지를 받는다

  Scenario: 부분 겹침 동시 예약 요청
    Given 고객 "김철수"가 전화번호 "010-1111-1111"로 예약을 준비한다
    And 고객 "이영희"가 전화번호 "010-2222-2222"로 예약을 준비한다
    When 김철수가 "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"을 예약하고
    And 동시에 이영희가 "2025-09-11"부터 "2025-09-13"까지 사이트 "A-01"을 예약한다
    Then 하나의 예약만 성공한다
    And 다른 예약은 "해당 기간은 이미 예약되어 있습니다" 오류 메시지와 함께 실패한다

Feature: 연박 예약 관리
  고객이 여러 날짜에 걸쳐 연속으로 예약할 수 있다

  Background:
    Given 캠핑 사이트 "A-01"이 존재한다
    And 고객 "김철수"가 전화번호 "010-1234-5678"로 예약을 요청한다

  Scenario: 정상적인 연박 예약
    Given "2025-09-10"부터 "2025-09-15"까지 사이트 "A-01"이 모두 사용 가능하다
    When "2025-09-10"부터 "2025-09-15"까지 사이트 "A-01"을 연박 예약한다
    Then 연박 예약이 성공한다
    And 예약된 모든 날짜가 '예약 불가' 상태가 된다
    And 6자리 영숫자 확인 코드가 반환된다

  Scenario: 연박 기간 중 일부 날짜가 이미 예약된 경우
    Given "2025-09-10"부터 "2025-09-15"까지 예약하려고 한다
    But "2025-09-12" 날짜는 이미 다른 고객이 예약했다
    When "2025-09-10"부터 "2025-09-15"까지 사이트 "A-01"을 연박 예약한다
    Then 연박 예약이 실패한다
    And "예약 기간 중 일부 날짜가 이미 예약되어 있습니다" 오류 메시지가 반환된다
    And 어떤 날짜도 예약되지 않는다

  Scenario: 최대 예약 가능 기간 초과
    Given 최대 예약 가능 기간이 30일이다
    When "2025-09-10"부터 "2025-10-15"까지 35일간 사이트 "A-01"을 연박 예약한다
    Then 연박 예약이 실패한다
    And "최대 예약 가능 기간을 초과했습니다" 오류 메시지가 반환된다

  Scenario: 연박 예약 취소
    Given "2025-09-10"부터 "2025-09-15"까지 사이트 "A-01"이 연박 예약되어 있다
    And 예약 확인 코드가 "ABC123"이다
    When 확인 코드 "ABC123"으로 예약을 취소한다
    Then 예약 취소가 성공한다
    And "2025-09-10"부터 "2025-09-15"까지 모든 날짜가 '예약 가능' 상태로 변경된다

  Scenario: 연박 예약 후 가용성 확인
    Given "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"이 연박 예약되어 있다
    When 다른 고객이 "2025-09-11" 날짜의 사이트 "A-01" 가용성을 확인한다
    Then 가용성 확인 시 "예약 불가" 상태로 표시된다

  Scenario: 연박 예약과 단일 날짜 예약 충돌
    Given "2025-09-10"부터 "2025-09-12"까지 사이트 "A-01"이 연박 예약되어 있다
    And 고객 "이영희"가 전화번호 "010-9876-5432"로 예약을 요청한다
    When "2025-09-11" 날짜에 사이트 "A-01"을 예약한다
    Then 예약이 실패한다
    And "해당 날짜는 이미 예약되어 있습니다" 오류 메시지가 반환된다
