Background:
- 고객이 홍길동이고 전화번호가 010-1234-5678이다
- 사이트 A-1이 존재한다

Feature: 예약 생성
  고객이 유효한 정보를 입력하면 시스템이 중복 예약을 방지하고 확인 코드와 함께 예약을 생성한다

  Scenario: 정상적인 예약 생성
    Given 오늘 날짜는 2024-12-01이다
    When 고객이 2024-12-05부터 2024-12-07까지 A-1 사이트를 예약한다
    Then 예약이 성공적으로 생성된다
    And HTTP 상태 코드는 201이다
    And 예약 상태는 "CONFIRMED"이다
    And 6자리 확인 코드가 생성된다

  Scenario: 과거 날짜로 예약 생성 시 에러
    Given 오늘 날짜는 2024-12-01이다
    When 고객이 2024-11-30부터 2024-12-02까지 A-1 사이트를 예약한다
    Then 예약 생성이 실패한다
    And 에러 메시지 "과거 날짜로 예약할 수 없습니다"가 반환된다

  Scenario: 30일 이후 날짜로 예약 생성 시 에러
    Given 오늘 날짜는 2024-12-01이다
    When 고객이 2025-01-15부터 2025-01-17까지 A-1 사이트를 예약한다
    Then 예약 생성이 실패한다
    And 에러 메시지 "30일 이후 날짜로 예약할 수 없습니다"가 반환된다

  Scenario: 종료일이 시작일보다 이전인 경우 에러
    Given 오늘 날짜는 2024-12-01이다
    When 고객이 2024-12-10부터 2024-12-08까지 A-1 사이트를 예약한다
    Then 예약 생성이 실패한다
    And 에러 메시지 "종료일이 시작일보다 이전일 수 없습니다"가 반환된다

  Scenario: 고객명이 빈 문자열인 경우 에러
    Given 오늘 날짜는 2024-12-01이다
    When 고객이 2024-12-05부터 2024-12-07까지 A-1 사이트를 예약한다
    Then 예약 생성이 실패한다
    And 에러 메시지 "예약자 이름을 입력해주세요"가 반환된다

  Scenario: 존재하지 않는 사이트로 예약 생성 시 에러
    Given 사이트 Z-1이 존재하지 않는다
    And 오늘 날짜는 2024-12-01이다
    When 고객이 2024-12-05부터 2024-12-07까지 Z-1 사이트를 예약한다
    Then 예약 생성이 실패한다
    And 에러 메시지 "존재하지 않는 캠핑장입니다"가 반환된다

  Scenario: 중복 예약 방지
    Given 고객 홍길동이 2024-12-05부터 2024-12-07까지 A-1 사이트를 예약했다
    And 다른 고객 김철수가 전화번호 010-2345-6789를 가지고 있다
    When 김철수가 2024-12-06부터 2024-12-08까지 A-1 사이트를 예약한다
    Then 예약 생성이 실패한다
    And 에러 메시지 "해당 기간에 이미 예약이 존재합니다"가 반환된다

  Scenario: 동시성 제어
    Given A-1 사이트가 예약 가능한 상태이다
    And 고객 홍길동과 김철수가 동시에 예약을 시도한다
    When 동시에 여러 고객이 2024-12-05부터 2024-12-07까지 A-1 사이트를 예약한다
    Then 단 하나의 예약만 성공한다
    And 나머지 예약들은 실패한다

  Scenario: 연박 예약 생성
    Given 사이트 A-1이 존재한다
    And 오늘 날짜는 2024-12-01이다
    When 고객이 2024-12-05부터 2024-12-08까지 A-1 사이트를 예약한다
    Then 예약이 성공적으로 생성된다
    And 4일간의 연박 예약이 생성된다

Feature: 예약 수정
  확인 코드가 일치하는 경우에만 기존 예약 정보를 수정할 수 있으며, 수정 시에도 중복 예약을 방지한다

  Scenario: 정상적인 예약 수정
    Given 고객 홍길동이 예약 ID 1로 예약을 생성했다
    And 확인 코드가 ABC123이다
    When 고객이 확인 코드 ABC123으로 예약을 수정한다
    And 새로운 예약 정보는 2024-12-10부터 2024-12-12까지 A-2 사이트이다
    Then 예약 수정이 성공한다
    And HTTP 상태 코드는 200이다
    And 수정된 예약 정보가 반환된다
    And 예약 상태는 "CONFIRMED"로 유지된다

  Scenario: 확인 코드가 일치하지 않는 경우 에러
    Given 고객 홍길동이 예약 ID 1로 예약을 생성했다
    And 확인 코드가 ABC123이다
    When 고객이 확인 코드 WRONG123으로 예약을 수정한다
    Then 예약 수정이 실패한다
    And 에러 메시지 "확인 코드가 일치하지 않습니다"가 반환된다

  Scenario: 존재하지 않는 예약 ID로 수정 시 에러
    Given 예약 ID 999가 존재하지 않는다
    When 고객이 확인 코드 ABC123으로 예약 ID 999를 수정한다
    Then 예약 수정이 실패한다
    And 에러 메시지 "예약을 찾을 수 없습니다"가 반환된다

  Scenario: 30일 이후 날짜로 수정 시 에러
    Given 고객 홍길동이 예약 ID 1로 예약을 생성했다
    And 확인 코드가 ABC123이다
    And 오늘 날짜는 2024-12-01이다
    When 고객이 확인 코드 ABC123으로 예약을 수정한다
    And 새로운 예약 정보는 2025-01-15부터 2025-01-17까지 A-1 사이트이다
    Then 예약 수정이 실패한다
    And 에러 메시지 "30일 이후 날짜로 수정할 수 없습니다"가 반환된다

  Scenario: 존재하지 않는 사이트로 수정 시 에러
    Given 고객 홍길동이 예약 ID 1로 예약을 생성했다
    And 확인 코드가 ABC123이다
    And 사이트 Z-1이 존재하지 않는다
    When 고객이 확인 코드 ABC123으로 예약을 수정한다
    And 새로운 예약 정보는 2024-12-10부터 2024-12-12까지 Z-1 사이트이다
    Then 예약 수정이 실패한다
    And 에러 메시지 "존재하지 않는 캠핑장입니다"가 반환된다

  Scenario: 부분 수정
    Given 고객 홍길동이 예약 ID 1로 2024-12-05부터 2024-12-07까지 A-1 사이트를 예약했다
    And 확인 코드가 ABC123이다
    When 고객이 확인 코드 ABC123으로 예약을 수정한다
    And 시작일만 2024-12-10으로 변경한다
    Then 예약 수정이 성공한다
    And 시작일은 2024-12-10으로 변경된다
    And 종료일은 2024-12-07로 유지된다
    And 사이트는 A-1로 유지된다

  Scenario: 동시성 제어
    Given 고객 홍길동이 예약 ID 1로 예약을 생성했다
    And 확인 코드가 ABC123이다
    When 동시에 여러 요청으로 확인 코드 ABC123으로 예약을 수정한다
    Then 단 하나의 수정만 성공한다
    And 나머지 수정 요청들은 실패한다

Feature: 예약 캘린더 조회
  유효한 연도, 월, 사이트 ID를 입력하면 해당 사이트의 월별 예약 현황을 일별로 표시하는 캘린더 정보를 반환한다

  Scenario: 정상적인 캘린더 조회
    Given 사이트 ID 1이 존재한다
    And 연도 2024 월 12에 대한 예약 데이터가 있다
    When 사용자가 사이트 ID 1의 2024년 12월 캘린더를 조회한다
    Then 캘린더 조회가 성공한다
    And HTTP 상태 코드는 200이다
    And 연도 2024 월 12 사이트 ID 1이 포함된 캘린더 정보가 반환된다
    And 각 날짜별로 가용 여부가 표시된다
    And 요약 정보가 포함된다

  Scenario: 존재하지 않는 사이트 ID로 조회 시 에러
    Given 사이트 ID 999가 존재하지 않는다
    When 사용자가 사이트 ID 999의 2024년 12월 캘린더를 조회한다
    Then 캘린더 조회가 실패한다
    And 에러 메시지 "사이트를 찾을 수 없습니다"가 반환된다

  Scenario: 예약 상태 표시
    Given 사이트 ID 1이 존재한다
    And 2024년 12월 5일부터 7일까지 사이트 ID 1에 홍길동의 예약이 있다
    And 2024년 12월 10일에 사이트 ID 1에 김철수의 취소된 예약이 있다
    When 사용자가 사이트 ID 1의 2024년 12월 캘린더를 조회한다
    Then 캘린더 조회가 성공한다
    And 2024년 12월 5일부터 7일까지는 예약된 상태로 표시된다
    And 2024년 12월 10일은 예약 가능한 상태로 표시된다
    And 예약된 날짜에는 고객명과 예약 ID가 표시된다

  Scenario: 연박 예약 표시
    Given 사이트 ID 1이 존재한다
    And 2024년 12월 5일부터 8일까지 사이트 ID 1에 홍길동의 연박 예약이 있다
    When 사용자가 사이트 ID 1의 2024년 12월 캘린더를 조회한다
    Then 캘린더 조회가 성공한다
    And 2024년 12월 5일부터 8일까지 모든 날짜가 예약된 상태로 표시된다
    And 각 날짜에 홍길동의 예약 정보가 표시된다
