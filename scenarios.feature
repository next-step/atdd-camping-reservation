# language: ko
Feature: 캠핑장 예약 관리
  캠핑장 예약 시스템의 핵심 기능인 예약 생성, 동시성 제어, 예약 취소에 대한 인수 조건을 검증한다.

  Background:
    Given 대형 사이트 'A-1'과 소형 사이트 'B-1'이 등록되어 있다.
    And 오늘 날짜는 2025-09-04 이다.

  Scenario: ✅사용자가 유효한 정보로 예약을 성공적으로 생성한다.
    When 사용자가 이름, 전화번호로 사이트 'A-1'에 '2025-09-10' 날짜로 예약을 요청하면
    Then 예약은 성공적으로 처리된다.
    And 응답에는 6자리의 영숫자 확인 코드가 포함되어야 한다.

  Scenario: ✅이미 예약된 날짜에 중복으로 예약을 시도하면 실패한다.
    Given 2025-09-10일에 대형 사이트 'A-1'에 이미 예약이 존재할 때
    When 다른 사용자가 사이트 'A-1'에 대해 2025-09-10일을 포함하는 기간으로 예약을 요청하면
    Then "해당 기간에 이미 예약이 존재합니다."와 같은 메시지와 함께 예약이 실패한다.

  Scenario: 과거 날짜로 예약을 시도하면 실패한다.
    When 사용자가 예약할 때, 시작 날짜를 오늘보다 과거로 지정하면
    Then "유효하지 않은 날짜입니다."와 같은 메시지와 함께 예약은 실패한다.

  Scenario: 유효하지 않은 기간으로 예약을 시도하면 실패한다.
    When 사용자가 예약할 때, 종료 날짜를 시작 날짜보다 이전으로 지정하면
    Then "종료일이 시작일보다 이전일 수 없습니다."와 같은 메시지와 함께 예약이 실패한다.

  Scenario: 30일 이후 기간으로 예약을 시도하면 실패한다.
    When 사용자가 예약할 때, 예약 기간에 30일 이후 날짜가 포함되면
    Then "30일 이내 기간으로만 예약이 가능합니다."와 같은 메시지와 함께 예약이 실패한다.

  Scenario: 취소된 예약 날짜에 새로운 예약을 성공적으로 생성한다.
    Given 'A-1' 사이트에 특정 날짜로 예약이 생성되었다가 취소되었을 때
    When 다른 사용자가 동일한 사이트와 날짜로 새로운 예약을 요청하면
    Then 예약은 성공적으로 처리된다.
    And 'A-1' 사이트의 취소된 예약 날짜에 새로운 사용자 정보로 예약이 생긴다.

  Scenario: 여러 사용자가 동시에 동일한 예약을 요청할 경우, 단 하나의 요청만 성공한다.
    When 여러 사용자가 동시에 'A-1' 사이트에 동일한 날짜로 예약을 요청하면
    Then 오직 하나의 예약 요청만 성공하고, 나머지 요청은 모두 실패한다.
    And 해당 날짜에는 하나의 예약만 생긴다.

  Scenario: 사용자가 올바른 확인 코드로 자신의 예약을 성공적으로 취소한다.
    When 사용자가 취소하고 싶은 예약의 예약 ID와 확인 코드로 취소를 요청하면
    Then 예약 취소는 성공적으로 처리된다.
    And 취소된 사이트와 날짜는 이제 다른 사용자가 예약할 수 있는 상태가 된다.

  Scenario: 사용자가 잘못된 확인 코드로 예약을 취소하려 하면 실패한다.
    Given 사용자가 사이트 'A-1'을 예약해둔 상태일 때
    When 사용자가 해당 예약 ID와 유효하지 않은 확인 코드로 취소를 요청하면
    Then "확인 코드가 일치하지 않습니다."와 같은 메시지와 함께 예약 취소가 실패한다.

  Scenario: 당일 예약을 취소할 경우 환불 불가 정책이 적용된다.
    Given 오늘 날짜(2025-09-04)로 'A-1' 사이트에 예약이 존재할 때
    When 사용자가 해당 예약을 취소하면
    Then 예약 취소는 성공적으로 처리된다.
    And 사용자는 예약 취소 후 환불 불가라는 것을 알 수 있어야 한다.

  Scenario: 예약일 이전에 취소할 경우 전액 환불 정책이 적용된다.
    Given 내일 날짜(2025-09-05)로 'B-1' 사이트에 예약이 존재할 때
    When 사용자가 해당 예약을 취소하면
    Then 예약 취소는 성공적으로 처리된다.
    And 사용자는 예약 취소 후 전액 환불이 된 것을 알 수 있어야 한다.

